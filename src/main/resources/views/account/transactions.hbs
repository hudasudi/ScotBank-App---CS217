<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Transactions - ScotBank</title>
    <link rel="stylesheet" href="../assets/static/css/account/transactions.css">
</head>

<body>
<div class = "header">
    <h1>Transaction Details</h1>
</div>

<nav class="navbar">
    <a href="/account/dashboard">Home</a>
    <a class="active" href="/account/transactions">Transactions</a>
    <a href="/account/summary">Account Summary</a>
    <a href="/account/settings">Settings</a>
</nav>

<section class="trans-overview">
    <h2>Transactions Overview</h2>
    <p><b>In:</b> £{{income}}</p>
    <p><b>Out:</b> £{{outgoings}}</p>
    <p class="trans-overview-total"><b>Total:</b> £{{account.bal}}</p>
</section>

<!-- Transactions Table -->
<section class="transactions">
    <h2>Transactions</h2>
    <table>
        <thead>
        <tr>
            <th>Date</th>
            <th>Description</th>
            <th>Amount (£)</th>
            <th>Balance (£)</th>
            <th>View</th>
        </tr>
        </thead>

        <tbody id="table-body"></tbody>
    </table>

    <p id="load-more-button" onclick="showMoreRows()">Load More</p>
</section>

<script>
    function capitalize(text) {
        return text.charAt(0).toUpperCase() + text.slice(1);
    }

    const transactions = [
        {{#each transactions}}
            [
                "{{this.timestamp_date}}",
                "{{this.to-from}}",
                "{{this.amount}}",
                "{{this.current_balance}}",
                "{{this.timestamp_time}}",
                capitalize("{{this.type}}"),
                "{{this.category}}"
            ]{{#unless @last}},{{/unless}}
        {{/each}}
    ];

    let currentIndex = 0; // Tracks how many rows are displayed
    const rowsPerPage = 25;
    const tableBody = document.getElementById("table-body");
    const loadMoreBtn = document.getElementById("load-more-button");

    function showMoreRows() {
        const nextIndex = Math.min(currentIndex + rowsPerPage, transactions.length);

        for (let i = currentIndex; i < nextIndex; i++) {
            let row = document.createElement("tr");
            row.innerHTML = `
                        <td>${transactions[i][0]}</td>
                        <td>${transactions[i][1]}</td>
                        <td>${transactions[i][2]}</td>
                        <td>${transactions[i][3]}</td>
                        <td><button class="view-btn">See Details</button></td>
                    `;
            tableBody.appendChild(row);

            // Create a hidden row for details
            let detailsRow = document.createElement("tr");
            detailsRow.classList.add("details-row");
            detailsRow.style.display = "none"; // Initially hidden
            detailsRow.innerHTML = `
                        <td colspan="5">
                            <div class="details-content">
                                <div class="details-item"><b>Time:</b> ${transactions[i][4]}<br></div>
                                <div class="details-item"><b>Transaction Type:</b> ${transactions[i][5]}<br></div>
                                <div class="details-item"><b>Business Category:</b> ${transactions[i][6]}<br></div>
                            </div>
                        </td>
                    `;
            tableBody.appendChild(detailsRow);

            // Attach event listener to toggle details row
            row.querySelector(".view-btn").addEventListener("click", function () {
                detailsRow.style.display = detailsRow.style.display === "none" ? "table-row" : "none";
            });
        }

        currentIndex = nextIndex;

        // Hide button when all rows are displayed
        if (currentIndex >= transactions.length) {
            loadMoreBtn.style.display = "none";
        }
    }

    // Load initial rows
    showMoreRows();
</script>
</body>
</html>